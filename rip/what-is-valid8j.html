<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.9.1 from src/site/asciidoc/rip/what-is-valid8j.adoc at 2024-06-28
 | Rendered using Apache Maven Fluido Skin 1.7
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20240628" />
    <meta http-equiv="Content-Language" content="en" />
    <title>valid8j &#x2013; </title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.7.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />
    <script type="text/javascript" src="../js/apache-maven-fluido-1.7.min.js"></script>
  </head>
  <body class="topBarDisabled">
    <div class="container-fluid">
      <div id="banner">
        <div class="pull-left"><div id="bannerLeft"><h2>valid8j</h2>
</div>
</div>
        <div class="pull-right"></div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
        <li id="publishDate">Last Published: 2024-06-28<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 2.1.3</li>
        </ul>
      </div>
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
    <ul class="nav nav-list">
      <li class="nav-header">Documents</li>
    <li><a href="../valid8j-1-introduction.html" title="Introduction"><span class="none"></span>Introduction</a></li>
    <li><a href="../valid8j-2-getting-started.html" title="Getting Started"><span class="none"></span>Getting Started</a></li>
    <li><a href="../valid8j-3-architecture.html" title="Architecture, Design Principles, and Techniques"><span class="none"></span>Architecture, Design Principles, and Techniques</a></li>
    <li><a href="../valid8j-4-guides-and-tutorials.html" title="Guides and Tutorials"><span class="none"></span>Guides and Tutorials</a></li>
    <li><a href="../valid8j-5-advanced-topics.html" title="Advanced Topics"><span class="none"></span>Advanced Topics</a></li>
    <li><a href="../apidocs/index.html" title="JavaDoc:valid8j"><span class="none"></span>JavaDoc:valid8j</a></li>
    <li><a href="../valid8j-6-limitations-and-future-works.html" title="Limitations and Future Works"><span class="none"></span>Limitations and Future Works</a></li>
    <li><a href="../valid8j-7-faq.html" title="FAQs"><span class="none"></span>FAQs</a></li>
    <li><a href="../valid8j-8-development.html" title="Development"><span class="none"></span>Development</a></li>
    <li><a href="../valid8j-9-support.html" title="Contact and Support"><span class="none"></span>Contact and Support</a></li>
      <li class="nav-header">Project Documentation</li>
    <li><a href="../project-info.html" title="Project Information"><span class="icon-chevron-right"></span>Project Information</a></li>
    <li><a href="../project-reports.html" title="Project Reports"><span class="icon-chevron-right"></span>Project Reports</a></li>
</ul>
          <hr />
          <div id="poweredBy">
            <div class="clear"></div>
            <div class="clear"></div>
            <div class="clear"></div>
            <div class="clear"></div>
<a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="../images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </div>
        <div id="bodyColumn"  class="span10" >
<h1>The <code>valid8j</code> library powered by <code>pcond</code></h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><code>valid8j</code> (pronounced validate-j) is a DbC (design by contract<a href="#DbC">[1]</a>) library named after <code>valid4j</code><a href="#valid4j">[2]</a>.
It uses <code>pcond</code><a href="#pcond">[3]</a>, which provides you with predicates that can print descriptive message on a failure, instead of <code>hamcrest</code> used by <code>valid4j</code>.
The benefit of <code>pcond</code> over <code>hamcrest</code> is its compatibility and extensibility.
Instead of "matchers" that <code>hamcrest</code> uses to verify values, <code>pcond</code> uses Java&#8217;s plain <code>Predicate</code> and provide useful preset predicates from which you can build your own predicates for complex types.
So, you can reuse the predicates you created for assertions for other purposes, such as value checking and testing.</p>
</div>
<div class="paragraph">
<p>A design idea behind <code>pcond</code> is following:
When a human checks test results, he/she wants to "see" the values on a display screen as texts.
But what sort of values they can check?
Numbers, texts, boolean, null, or compound values of them.
Database records, HTTP requests, responses, List, Map, &#8230;&#8203; they can be decomposed into the handful of value types.
If cannot, they cannot be understood by human, either way.
If so, when a human checks such a complex value, what human does will be to extract a certain aspect of the original complex value as a simple value and check if it satisfies a certain predicate for a simple value type.
If so, the mechanism we desire for a versatile assertion library is not to be able to build a matcher for any types, but to be able to define a function to "transform"  a given object to a simple value, and provide a useful and preset predicates sufficient for checking the extracted value.</p>
</div>
<div class="paragraph">
<p>This allows you to use the library for your custom class very easily.</p>
</div>
<div class="paragraph">
<p>Not only that, it allows "no-overhead" execution of assertions, which gives no performance penalty at production code, yet keeping its descriptiveness on failures.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="before_using_assert_var_null_vs_objects_requirenonnullvar">Before Using: <code>assert var != null</code> vs <code>Objects.requireNonNull(var)</code></h2>
<div class="sectionbody">
<div class="paragraph">
<p>What are the differences between them?
For what a situation do you use <code>assert</code> or <code>requireNonNull</code>?</p>
</div>
<div class="paragraph">
<p><code>assert</code> throws <code>java.lang.AssertionError</code> and for <code>requireNonNull</code>, <code>java.lang.NullPointerException</code> is thrown, when the <code>var</code> is <code>null</code>.
And, in both cases, we consider that a bug is detected and therefore, the exception should not be caught.</p>
</div>
<div class="paragraph">
<p>Then which should be used when?</p>
</div>
<div class="listingblock">
<div class="content">
<pre>+------+    +-----------------------+
|Client|    |Your Product           |
|      |    |    +----------------+ |
|      +---&gt;|    |Internal Classes| |
|      |    |    +----------------+ |
+------+    +-----------------------+</pre>
</div>
</div>
<div class="paragraph">
<p>The author of <code>valid8j</code> thinks as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When you are detecting a bug of your client&#8217;s, use <code>requireNonNull(var)</code>: Because you want to enforce a certain constraint on the values your user client gives to your product.</p>
</li>
<li>
<p>When you are detecting a bug of your own library, use <code>assert var != null</code>: Because you want to allow your users to disable the checks to provide the best performance of your product.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If so, as a rule of thumb, the former should be used in <code>public</code>  in general, and the other, in <code>private</code> or package-private methods.</p>
</div>
<div class="sect2">
<h3 id="one_more_consideration">One More Consideration</h3>
<div class="paragraph">
<p>In public methods, we throw <code>NullPointerException</code> and <code>IllegalArgumentException</code> if a given argument doesn&#8217;t satisfy a constraint a method has.
This is widely accepted convention, but does it hold anytime?
Perhaps, your product may have a policy about exceptions to be thrown, where custom exceptions should always be used to be able to compose a user-friendly message.</p>
</div>
<div class="paragraph">
<p>You can tweak exceptions to be thrown by "reconfigure" a <code>Validator</code> instance used in your current thread.
Check <code>Validator.reconfigure</code> and <code>Validator.Configuration.Builder.exceptionComposerForRequire</code> to configure the exceptions to be thrown when a requirement for your method is broken.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="usage">Usage</h2>
<div class="sectionbody">
<div class="paragraph">
<p>First, let&#8217;s import statically entry points of the library in your code.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"></code></pre>
</div>
</div>
<div class="paragraph">
<p>Of course, you can rely on your IDE for it, though.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import static com.github.dakusui.valid8j_pcond.forms.Functions.length;
import static com.github.dakusui.valid8j_pcond.forms.Predicates.*;
public class Example {
  public void publicMethod(String message) {
    require(message, and(isNotNull(), transform(length()).check(greaterThan(0))));
    privateMethod(message);
  }

  private void privateMethod(String message) {
    assert precondition(message, and(isNotNull(), transform(length()).check(greaterThan(0))));
    System.out.println(message);
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you give <code>null</code> to the methods in the example, you will get a following output.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Exception in thread "main" com.github.dakusui.valid8j_pcond.validator.exceptions.PreconditionViolationException: value:&lt;null&gt; violated precondition:value (isNotNull&amp;&amp;length &gt;[0])
Mismatch&lt;:    null-&gt;and         -&gt;true
Mismatch&gt;:    null-&gt;and         -&gt;false
Mismatch&lt;:[0]     -&gt;  isNotNull -&gt;true
Mismatch&gt;:[0]     -&gt;  isNotNull -&gt;false

.Detail of failure [0] (expectation)
---
isNotNull
---

.Detail of failure [0] (actual value)
---
null
---
	at com.github.dakusui.valid8j_pcond.validator.ExceptionComposer$ForRequire.exceptionForGeneralViolation(ExceptionComposer.java:164)
	at com.github.dakusui.com.github.dakusui.valid8j_pcond.validator.valid8j_pcond.Validator.lambda$require$1(Validator.java:101)----</pre>
</div>
</div>
<div class="paragraph">
<p>Note that the <code>that</code> method throws an exception rather than returning <code>false</code> when the given predicate results in <code>false</code> and therefore it can compose the descriptive exception message.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="performance">Performance</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>precondition</code> method is defined to return a <code>boolean</code> value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class Example {
  private void privateMethod(String message) {
    assert precondition(message, isNotNull()); //<b class="conum">(1)</b>
    System.out.println(mesage);
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>This line is not executed at all if you give <code>-da</code> option to your JVM.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>But it will never return <code>false</code>.
If the method finds the predicate results in <code>false</code>, it will throw an exception, instead of returning <code>false</code>.
In the exception, an informative message will be embedded.</p>
</div>
<div class="paragraph">
<p>From the performance perspective, the <code>precondition</code> method is relatively time-consuming because it traverses the predicate tree to compose a message.
However, here&#8217;s one thing, it&#8217;s an expression passed to <code>assert</code> statement.
If you disable assertion (<code>-da</code>), which is the practice you always exercise in the production code, the statement will not be executed at all.
So, there will be no performance overhead in production.
Also, note that you can even control the assertion behavior per-package basis<a href="#assertions">[4]</a>.
This is why you should prefer <code>valid8j</code> over existing value checking libraries such as <code>Preconditions</code><a href="#Preconditions-guava">[5]</a> or <code>Validates</code><a href="#Validates-apache-commons">[6]</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="references">References</h2>
<div class="sectionbody">
<div class="ulist bibliography">
<ul class="bibliography">
<li>
<p><a id="DbC"></a>[1] Wikipedia article on Design by Contract, <a href="https://en.wikipedia.org/wiki/Design_by_contract" class="bare">https://en.wikipedia.org/wiki/Design_by_contract</a></p>
</li>
<li>
<p><a id="valid4j"></a>[2] valid4j <a href="https://www.valid4j.org/">valid4j.org</a></p>
</li>
<li>
<p><a id="pcond"></a>[3] pcond <a href="https://dakusui.github.io/pcond/">github.com/pcond</a></p>
</li>
<li>
<p><a id="assertions"></a>[4] Programming With Assertions <a href="https://docs.oracle.com/javase/8/docs/technotes/guides/language/assert.html" class="bare">https://docs.oracle.com/javase/8/docs/technotes/guides/language/assert.html</a></p>
</li>
<li>
<p><a id="Preconditions-guava"></a>[5] Preconditions, Google Guava <a href="https://guava.dev/releases/19.0/api/docs/com/google/common/base/Preconditions.html">Preconditions class</a></p>
</li>
<li>
<p><a id="Validates-apache-commons"></a>[6] Validates, Apache Commons <a href="https://commons.apache.org/proper/commons-lang/apidocs/org/apache/commons/lang3/Validate.html">Validate class</a></p>
</li>
</ul>
</div>
</div>
</div>
        </div>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>Copyright &copy;2024.
All rights reserved.</p>
        </div>
      </div>
    </footer>
  </body>
</html>
